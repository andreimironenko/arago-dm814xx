include Rules.make

DEFAULT_LINUXKERNEL_CONFIG=ti8168_evm_defconfig
DEFAULT_UBOOT_CONFIG=ti8168_evm_config
DMAI_PLATFORM=o3530_al
# export cross compiler location in PATH
PATH := ${PATH}:${CSTOOL_PATH}

.PHONY:	components components_clean all clean help cmem cmem_clean cmem_install linux linux_clean linux_install install u-boot u-boot_clean u-boot_install c6accel c6accel_clean c6accel_install syslink syslink_clean syslink_install 

#==============================================================================
# Build components to enable all other build targets. 
#==============================================================================
components: linux cmem syslink c6accel 

#==============================================================================
# Clean up the targets built by 'make all'.
#==============================================================================
components_clean: linux_clean syslink_clean cmem_clean c6accel_clean

#==============================================================================
# Build everything rebuildable.
#==============================================================================
all: components u-boot ceexamples

#==============================================================================
# Install everything
#==============================================================================
# install: linux_install cmem_install ceexamples_install syslink_install u-boot_install psp_examples_install c6accel_install opengldemos_install 
install: linux_install cmem_install ceexamples_install syslink_install u-boot_install c6accel_install 

#==============================================================================
# Clean up all targets.
#==============================================================================
# clobber: clean ceexamples_clean u-boot_clean psp_examples_clean opengldemos_clean 
clean: components_clean ceexamples_clean u-boot_clean 

#==============================================================================
# A help message target.
#==============================================================================
help:
	@echo
	@echo "Available build targets are:"
	@echo
	@echo "    components                   : Build the components for which a rebuild is necessary to enable all other build targets listed below. You must do this at least once upon installation prior to attempting the other targets."
	@echo "    components_clean             : Remove files generated by the 'components' target"
	@echo 
	@echo "    cmem                         : Build the CMEM kernel module"
	@echo "    cmem_clean                   : Remove generated cmem files."
	@echo "    cmem_install                 : Install cmemk module"
	@echo
	@echo "    syslink                      : Configure and build SYS Link for HLOS and HLOS without sample examples"
	@echo "    syslink_clean                : Remove generated SysLink files"
	@echo "    syslink_install              : Install HLOS and RTOS link files"
	@echo
	@echo "    syslink_hlos                 : Configure and build DSP Link for ARM"
	@echo "    syslink_hlos_clean           : Clean DSP Link for ARM"
	@echo 
	@echo "    syslink_rtos                 : Configure and build SysLink for RTOS"
	@echo "    syslink_rtos_clean           : Clean SysLink for RTOS"
	@echo 
	@echo "    ceexamples                   : Build CE codecs, extensions, servers and apps"
	@echo "    ceexamples_clean             : Remove generated CE example files."
	@echo
	@echo "    linux                        : Build Linux kernel uImage and module"
	@echo "    linux_clean                  : Remove generated Linux kernel files"
	@echo "    linux_install                : Install kernel binary and  modules"
	@echo
	@echo "    u-boot                       : Build the u-boot boot loader"
	@echo "    u-boot_clean                 : Remove generated u-boot files"
	@echo "    u-boot_install               : Install the u-boot image"
	@echo
#	@echo "    psp_examples                 : Build Linux examples"
#	@echo "    psp_examples_clean           : Remove all generated PSP examples"
#	@echo "    psp_examples_install         : Install psp examples"
#	@echo
	@echo "    c6accel                      : Build c6accel package"
	@echo "    c6accel_clean                : Remove generated c6accel files"
	@echo "    c6accel_install              : Install c6accel examples"
	@echo
#	@echo "    opengldemos                  : Build the OPENGL graphics SDK demos for $(PLATFORM)"
#	@echo "    opengldemos_clean            : Remove OPENGL graphics SDK demo files."
#	@echo "    opengldemos_install          : install OPENGL graphics SDK demo executables."
#	@echo
	@echo "    all                          : Rebuild everything"
	@echo "    clean                        : Remove all generated files"
	@echo
	@echo "    install                      : Install all the targets in "
	@echo "                            $(EXEC_DIR)"
	@echo

#==============================================================================
# Build the Linux kernel. Also, an explicit cleanup target is defined.
#==============================================================================
linux:
	$(MAKE) -C $(LINUXKERNEL_INSTALL_DIR) ARCH=arm CROSS_COMPILE=$(CSTOOL_PREFIX) $(DEFAULT_LINUXKERNEL_CONFIG)
	$(MAKE) -C $(LINUXKERNEL_INSTALL_DIR) ARCH=arm CROSS_COMPILE=$(CSTOOL_PREFIX) uImage
	$(MAKE) -C $(LINUXKERNEL_INSTALL_DIR) ARCH=arm CROSS_COMPILE=$(CSTOOL_PREFIX) modules
linux_clean:
	$(MAKE) -C $(LINUXKERNEL_INSTALL_DIR) mrproper
	$(MAKE) -C $(LINUXKERNEL_INSTALL_DIR) ARCH=arm CROSS_COMPILE=$(CSTOOL_PREFIX) clean

linux_install:
	install -d $(EXEC_DIR)/boot
	install  $(LINUXKERNEL_INSTALL_DIR)/arch/arm/boot/uImage $(EXEC_DIR)/boot
	install  $(LINUXKERNEL_INSTALL_DIR)/vmlinux $(EXEC_DIR)/boot
	install  $(LINUXKERNEL_INSTALL_DIR)/System.map $(EXEC_DIR)/boot
	$(MAKE) -C $(LINUXKERNEL_INSTALL_DIR) ARCH=arm CROSS_COMPILE=$(CSTOOL_PREFIX) INSTALL_MOD_PATH=$(EXEC_DIR)/ modules_install

#==============================================================================
# Build u-boot. Also, an explicit cleanup target is defined.
#==============================================================================
u-boot:
	$(MAKE) -C $(PSP_INSTALL_DIR)/u-boot-* CROSS_COMPILE=$(CSTOOL_PREFIX) $(DEFAULT_UBOOT_CONFIG)
	$(MAKE) -C $(PSP_INSTALL_DIR)/u-boot-* CROSS_COMPILE=$(CSTOOL_PREFIX)

u-boot_clean: 
	$(MAKE) -C $(PSP_INSTALL_DIR)/u-boot-* CROSS_COMPILE=$(CSTOOL_PREFIX) distclean

u-boot_install:
	install -d $(EXEC_DIR)/boot
	install $(PSP_INSTALL_DIR)/u-boot-*/u-boot.bin $(EXEC_DIR)/boot
	install $(PSP_INSTALL_DIR)/u-boot-*/u-boot.map $(EXEC_DIR)/boot

#==============================================================================
# Build the PSP Linux examples. Also, an explicit cleanup target is defined.
#==============================================================================
# psp_examples:
#	$(MAKE) -C $(PSP_INSTALL_DIR)/linux-driver-examples-*/audio PLAT=omap3530 KERNEL_DIR=$(LINUXKERNEL_INSTALL_DIR)/include LIB_INC=$(LINUXLIBS_INSTALL_DIR)/include LIB_DIR=$(LINUXLIBS_INSTALL_DIR)/lib all
#	$(MAKE) -C $(PSP_INSTALL_DIR)/linux-driver-examples-*/video PLAT=omap3530 KERNEL_DIR=$(LINUXKERNEL_INSTALL_DIR) LIB_INC=$(LINUXLIBS_INSTALL_DIR)/include LIB_DIR=$(LINUXLIBS_INSTALL_DIR)/lib all
#
#psp_examples_clean:
#	$(MAKE) -C $(PSP_INSTALL_DIR)/linux-driver-examples-*/audio PLAT=omap3530 KERNEL_DIR=$(LINUXKERNEL_INSTALL_DIR)/include LIB_INC=$(LINUXLIBS_INSTALL_DIR)/include LIB_DIR=$(LINUXLIBS_INSTALL_DIR)/lib clean
#	$(MAKE) -C $(PSP_INSTALL_DIR)/linux-driver-examples-*/video PLAT=omap3530 KERNEL_DIR=$(LINUXKERNEL_INSTALL_DIR)/include LIB_INC=$(LINUXLIBS_INSTALL_DIR)/include LIB_DIR=$(LINUXLIBS_INSTALL_DIR)/lib clean
#
#psp_examples_install:
#	mkdir -p $(EXEC_DIR)/psp-examples/audio
#	cp  $(PSP_INSTALL_DIR)/linux-driver-examples-*/audio/bin/* $(EXEC_DIR)/psp-examples/audio
#	mkdir -p $(EXEC_DIR)/psp-examples/video
#	cp  $(PSP_INSTALL_DIR)/linux-driver-examples-*/video/bin/* $(EXEC_DIR)/psp-examples/video
#	
#==============================================================================
# Build the CMEM kernel module for the configured platform, and make sure the
# kernel_binaries directory is kept in sync. Also, an explicit cleanup target
# is defined.
#==============================================================================
cmem:
	$(MAKE) -C $(CMEM_INSTALL_DIR)/packages/ti/sdo/linuxutils/cmem/src/interface ../../lib/cmem.a470MV
	$(MAKE) -C $(CMEM_INSTALL_DIR)/packages/ti/sdo/linuxutils/cmem/src/module

cmem_clean:
	$(MAKE) -C $(CMEM_INSTALL_DIR)/packages/ti/sdo/linuxutils/cmem/src/module clean
	$(MAKE) -C $(CMEM_INSTALL_DIR)/packages/ti/sdo/linuxutils/cmem/src/interface clean

cmem_install:
	install -d $(EXEC_DIR)/cmem
	install $(CMEM_INSTALL_DIR)/packages/ti/sdo/linuxutils/cmem/src/module/cmemk.ko $(EXEC_DIR)/cmem

###############################################################################
# Build codec engine examples
###############################################################################
ceexamples_apps:
	make -C $(CE_INSTALL_DIR)/examples/ti/sdo/ce/examples/apps \
	DEVICES="TI816X" \
	GPPOS=LINUX_GCC \
	PROGRAMS="APP_CLIENT DSP_SERVER" \
	CE_INSTALL_DIR=$(CE_INSTALL_DIR) \
	FC_INSTALL_DIR=$(FC_INSTALL_DIR) \
	SYSLINK_INSTALL_DIR=$(SYSLINK_INSTALL_DIR) \
	CMEM_INSTALL_DIR=$(CMEM_INSTALL_DIR) \
	XDAIS_INSTALL_DIR=$(XDAIS_INSTALL_DIR) \
	XDC_INSTALL_DIR=$(XDC_INSTALL_DIR) \
	BIOS_INSTALL_DIR=$(SYSBIOS_INSTALL_DIR) \
	CGTOOLS_C64P=$(CODEGEN_INSTALL_DIR) \
	CGTOOLS_C674=$(CODEGEN_INSTALL_DIR) \
	CGTOOLS_C674ELF=$(CODEGEN_INSTALL_DIR) \
	CGTOOLS_M3ELF=$(TMS470_CODEGEN_INSTALL_DIR) \
	EDMA3_LLD_INSTALL_DIR=$(EDMA3_LLD_INSTALL_DIR) \
	CGTOOLS_V5T=$(CSTOOL_DIR) \
	all 

ceexamples_apps_clean:
	make -C $(CE_INSTALL_DIR)/examples/ti/sdo/ce/examples/apps \
	DEVICES="TI816X" \
	GPPOS=LINUX_GCC \
	PROGRAMS="APP_CLIENT DSP_SERVER" \
	CE_INSTALL_DIR=$(CE_INSTALL_DIR) \
	FC_INSTALL_DIR=$(FC_INSTALL_DIR) \
	SYSLINK_INSTALL_DIR=$(SYSLINK_INSTALL_DIR) \
	CMEM_INSTALL_DIR=$(CMEM_INSTALL_DIR) \
	XDAIS_INSTALL_DIR=$(XDAIS_INSTALL_DIR) \
	XDC_INSTALL_DIR=$(XDC_INSTALL_DIR) \
	BIOS_INSTALL_DIR=$(SYSBIOS_INSTALL_DIR) \
	EDMA3_LLD_INSTALL_DIR=$(EDMA3_LLD_INSTALL_DIR) \
	CGTOOLS_C64P=$(CODEGEN_INSTALL_DIR) \
	CGTOOLS_C674=$(CODEGEN_INSTALL_DIR) \
	CGTOOLS_C674ELF=$(CODEGEN_INSTALL_DIR) \
	CGTOOLS_M3ELF=$(TMS470_CODEGEN_INSTALL_DIR) \
	CGTOOLS_V5T=$(CSTOOL_DIR) \
	clean 

ceexamples_apps_install:
	@echo 
	@echo "**** Don't have working install target ****"
	@echo "Copy the required application binaries and data files from $(CE_INSTALL_DIR)/examples/ti/sdo/ce/examples/apps to target filesystem. "
	@echo 

ceexamples_extensions:
	make -C $(CE_INSTALL_DIR)/examples/ti/sdo/ce/examples/extensions \
	DEVICES="TI816X" \
	GPPOS=LINUX_GCC \
	PROGRAMS="APP_CLIENT DSP_SERVER" \
	CE_INSTALL_DIR=$(CE_INSTALL_DIR) \
	FC_INSTALL_DIR=$(FC_INSTALL_DIR) \
	SYSLINK_INSTALL_DIR=$(SYSLINK_INSTALL_DIR) \
	CMEM_INSTALL_DIR=$(CMEM_INSTALL_DIR) \
	XDAIS_INSTALL_DIR=$(XDAIS_INSTALL_DIR) \
	XDC_INSTALL_DIR=$(XDC_INSTALL_DIR) \
	BIOS_INSTALL_DIR=$(SYSBIOS_INSTALL_DIR) \
	EDMA3_LLD_INSTALL_DIR=$(EDMA3_LLD_INSTALL_DIR) \
	CGTOOLS_C64P=$(CODEGEN_INSTALL_DIR) \
	CGTOOLS_C674=$(CODEGEN_INSTALL_DIR) \
	CGTOOLS_C674ELF=$(CODEGEN_INSTALL_DIR) \
	CGTOOLS_M3ELF=$(TMS470_CODEGEN_INSTALL_DIR) \
	CGTOOLS_V5T=$(CSTOOL_DIR) \
	all 

ceexamples_extensions_clean:
	make -C $(CE_INSTALL_DIR)/examples/ti/sdo/ce/examples/apps \
	DEVICES="TI816X" \
	GPPOS=LINUX_GCC \
	PROGRAMS="APP_CLIENT DSP_SERVER" \
	CE_INSTALL_DIR=$(CE_INSTALL_DIR) \
	FC_INSTALL_DIR=$(FC_INSTALL_DIR) \
	SYSLINK_INSTALL_DIR=$(SYSLINK_INSTALL_DIR) \
	CMEM_INSTALL_DIR=$(CMEM_INSTALL_DIR) \
	XDAIS_INSTALL_DIR=$(XDAIS_INSTALL_DIR) \
	XDC_INSTALL_DIR=$(XDC_INSTALL_DIR) \
	BIOS_INSTALL_DIR=$(SYSBIOS_INSTALL_DIR) \
	EDMA3_LLD_INSTALL_DIR=$(EDMA3_LLD_INSTALL_DIR) \
	CGTOOLS_C64P=$(CODEGEN_INSTALL_DIR) \
	CGTOOLS_C674=$(CODEGEN_INSTALL_DIR) \
	CGTOOLS_C674ELF=$(CODEGEN_INSTALL_DIR) \
	CGTOOLS_M3ELF=$(TMS470_CODEGEN_INSTALL_DIR) \
	CGTOOLS_V5T=$(CSTOOL_DIR) \
	clean 

ceexamples_extensions_install:
	@echo 
	@echo "**** Don't have working install target ****"
	@echo "Copy the required application binaries and data files from $(CE_INSTALL_DIR)/examples/ti/sdo/ce/examples/extensions to target filesystem. "
	@echo 


ceexamples_servers:
	make -C $(CE_INSTALL_DIR)/examples/ti/sdo/ce/examples/servers  \
	DEVICES="TI816X" \
	GPPOS="LINUX_GCC" \
	PROGRAMS="APP_CLIENT DSP_SERVER" \
	CE_INSTALL_DIR=$(CE_INSTALL_DIR) \
	FC_INSTALL_DIR=$(FC_INSTALL_DIR) \
	SYSLINK_INSTALL_DIR=$(SYSLINK_INSTALL_DIR) \
	CMEM_INSTALL_DIR=$(CMEM_INSTALL_DIR) \
	XDAIS_INSTALL_DIR=$(XDAIS_INSTALL_DIR) \
	XDC_INSTALL_DIR=$(XDC_INSTALL_DIR) \
	BIOS_INSTALL_DIR=$(SYSBIOS_INSTALL_DIR) \
	EDMA3_LLD_INSTALL_DIR=$(EDMA3_LLD_INSTALL_DIR) \
	CGTOOLS_C64P=$(CODEGEN_INSTALL_DIR) \
	CGTOOLS_C674=$(CODEGEN_INSTALL_DIR) \
	CGTOOLS_C674ELF=$(CODEGEN_INSTALL_DIR) \
	CGTOOLS_M3ELF=$(TMS470_CODEGEN_INSTALL_DIR) \
	CGTOOLS_V5T=$(CSTOOL_DIR) \
	all 

ceexamples_servers_clean:
	make -C $(CE_INSTALL_DIR)/examples/ti/sdo/ce/examples/servers \
	DEVICES="TI816X" \
	GPPOS=LINUX_GCC \
	PROGRAMS="APP_CLIENT DSP_SERVER" \
	CE_INSTALL_DIR=$(CE_INSTALL_DIR) \
	FC_INSTALL_DIR=$(FC_INSTALL_DIR) \
	SYSLINK_INSTALL_DIR=$(SYSLINK_INSTALL_DIR) \
	CMEM_INSTALL_DIR=$(CMEM_INSTALL_DIR) \
	XDAIS_INSTALL_DIR=$(XDAIS_INSTALL_DIR) \
	XDC_INSTALL_DIR=$(XDC_INSTALL_DIR) \
	BIOS_INSTALL_DIR=$(SYSBIOS_INSTALL_DIR) \
	EDMA3_LLD_INSTALL_DIR=$(EDMA3_LLD_INSTALL_DIR) \
	CGTOOLS_C64P=$(CODEGEN_INSTALL_DIR) \
	CGTOOLS_C674=$(CODEGEN_INSTALL_DIR) \
	CGTOOLS_C674ELF=$(CODEGEN_INSTALL_DIR) \
	CGTOOLS_M3ELF=$(TMS470_CODEGEN_INSTALL_DIR) \
	CGTOOLS_V5T=$(CSTOOL_DIR) \
	clean 

ceexamples_servers_install:
	@echo 
	@echo "**** Don't have working install target ****"
	@echo "Copy the required application binaries and data files from $(CE_INSTALL_DIR)/examples/ti/sdo/ce/examples/servers to target filesystem. "
	@echo 


ceexamples_codecs:
	make -C $(CE_INSTALL_DIR)/examples/ti/sdo/ce/examples/codecs \
	DEVICES="TI816X" \
	GPPOS=LINUX_GCC \
	PROGRAMS="APP_CLIENT DSP_SERVER" \
	CE_INSTALL_DIR=$(CE_INSTALL_DIR) \
	FC_INSTALL_DIR=$(FC_INSTALL_DIR) \
	DSPLINK_INSTALL_DIR=$(SYSLINK_INSTALL_DIR) \
	CMEM_INSTALL_DIR=$(CMEM_INSTALL_DIR) \
	XDAIS_INSTALL_DIR=$(XDAIS_INSTALL_DIR) \
	XDC_INSTALL_DIR=$(XDC_INSTALL_DIR) \
	BIOS_INSTALL_DIR=$(SYSBIOS_INSTALL_DIR) \
	EDMA3_LLD_INSTALL_DIR=$(EDMA3_LLD_INSTALL_DIR) \
	CGTOOLS_C64P=$(CODEGEN_INSTALL_DIR) \
	CGTOOLS_C674=$(CODEGEN_INSTALL_DIR) \
	CGTOOLS_C674ELF=$(CODEGEN_INSTALL_DIR) \
	CGTOOLS_M3ELF=$(TMS470_CODEGEN_INSTALL_DIR) \
	CGTOOLS_V5T=$(CSTOOL_DIR) \
	all 

ceexamples_codecs_clean:
	make -C $(CE_INSTALL_DIR)/examples/ti/sdo/ce/examples/codecs \
	DEVICES="TI816X" \
	GPPOS=LINUX_GCC \
	PROGRAMS="APP_CLIENT DSP_SERVER" \
	CE_INSTALL_DIR=$(CE_INSTALL_DIR) \
	FC_INSTALL_DIR=$(FC_INSTALL_DIR) \
	SYSLINK_INSTALL_DIR=$(SYSLINK_INSTALL_DIR) \
	CMEM_INSTALL_DIR=$(CMEM_INSTALL_DIR) \
	XDAIS_INSTALL_DIR=$(XDAIS_INSTALL_DIR) \
	XDC_INSTALL_DIR=$(XDC_INSTALL_DIR) \
	BIOS_INSTALL_DIR=$(SYSBIOS_INSTALL_DIR) \
	EDMA3_LLD_INSTALL_DIR=$(EDMA3_LLD_INSTALL_DIR) \
	CGTOOLS_C64P=$(CODEGEN_INSTALL_DIR) \
	CGTOOLS_C674=$(CODEGEN_INSTALL_DIR) \
	CGTOOLS_C674ELF=$(CODEGEN_INSTALL_DIR) \
	CGTOOLS_M3ELF=$(TMS470_CODEGEN_INSTALL_DIR) \
	CGTOOLS_V5T=$(CSTOOL_DIR) \
	clean 

ceexamples_codecs_install:
	@echo 
	@echo "**** Don't have working install target ****"
	@echo "Copy the required application binaries and data files from $(CE_INSTALL_DIR)/examples/ti/sdo/ce/examples/codecs to target filesystem. "
	@echo 

ceexamples: ceexamples_codecs ceexamples_extensions ceexamples_servers ceexamples_apps
 
ceexamples_clean: ceexamples_codecs_clean ceexamples_extensions_clean ceexamples_servers_clean ceexamples_apps_clean

ceexamples_install: ceexamples_codecs_install ceexamples_extensions_install ceexamples_servers_install ceexamples_apps_install


###############################################################################
# Build codec engine examples
###############################################################################
SYSLINK_ROOT=${SYSLINK_INSTALL_DIR}
SYSLINK_XDCPATH="${IPC_INSTALL_DIR}/packages;${SYSBIOS_INSTALL_DIR}/packages"

syslink_cfg:
	sed -i \
        -e s:^C64.rootDir.*:C64.rootDir\ =\ \"${CODEGEN_INSTALL_DIR}\":g \
        -e s:^C64P_COFF.rootDir.*:C64P_COFF.rootDir\ =\ \"${CODEGEN_INSTALL_DIR}\":g \
        -e s:^C64P_ELF.rootDir.*:C64P_ELF.rootDir\ =\ \"${CODEGEN_INSTALL_DIR}\":g \
        -e s:^C67P_ELF.rootDir.*:C67P_ELF.rootDir\ =\ \"${CODEGEN_INSTALL_DIR}\":g \
        -e s:^C674_ELF.rootDir.*:C674_ELF.rootDir\ =\ \"${CODEGEN_INSTALL_DIR}\":g \
        -e s:^C674_COFF.rootDir.*:C674_COFF.rootDir\ =\ \"${CODEGEN_INSTALL_DIR}\":g \
        -e s:^Arm9.rootDir.*:Arm9.rootDir\ =\ \"${TMS470_CODEGEN_INSTALL_DIR}\":g \
        -e s:^M3_ELF.rootDir.*:M3_ELF.rootDir\ =\ \"${TMS470_CODEGEN_INSTALL_DIR}\":g \
        -e s:C64P_COFF,://C64P_COFF:g \
        -e s:C64P_ELF,://C64P_ELF:g \
        ${SYSLINK_INSTALL_DIR}/config.bld

syslink_hlos: 
	${MAKE} -C ${SYSLINK_INSTALL_DIR}/ti/syslink/utils/hlos/knl/Linux/ \
		SYSLINK_ROOT=${SYSLINK_INSTALL_DIR} \
		SYSLINK_PKGPATH="${IPC_INSTALL_DIR}/packages;${SYSLINK_INSTALL_DIR}" \
		ARCH=arm \
		CROSS_COMPILE=${CSTOOL_PREFIX} \
		TOOLCHAIN_PREFIX=${CSTOOL_PREFIX} \
		SYSLINK_PLATFORM=TI81XX \
		KDIR=$(LINUXKERNEL_INSTALL_DIR)
	${MAKE} -C ${SYSLINK_INSTALL_DIR}/ti/syslink/utils/hlos/usr/Linux/ \
		SYSLINK_ROOT=${SYSLINK_INSTALL_DIR} \
		SYSLINK_PKGPATH="${IPC_INSTALL_DIR}/packages;${SYSLINK_INSTALL_DIR}" \
		ARCH=arm \
		CROSS_COMPILE=${CSTOOL_PREFIX} \
		TOOLCHAIN_PREFIX=${CSTOOL_PREFIX} \
		SYSLINK_PLATFORM=TI81XX \
		KDIR=$(LINUXKERNEL_INSTALL_DIR)

syslink_hlos_clean: 
	${MAKE} -C ${SYSLINK_INSTALL_DIR}/ti/syslink/utils/hlos/knl/Linux/ \
		SYSLINK_ROOT=${SYSLINK_INSTALL_DIR} \
		SYSLINK_PKGPATH="${IPC_INSTALL_DIR}/packages;${SYSLINK_INSTALL_DIR}" \
		ARCH=arm \
		CROSS_COMPILE=${CSTOOL_PREFIX} \
		TOOLCHAIN_PREFIX=${CSTOOL_PREFIX} \
		SYSLINK_PLATFORM=TI81XX \
		KDIR=$(LINUXKERNEL_INSTALL_DIR) clean
	${MAKE} -C ${SYSLINK_INSTALL_DIR}/ti/syslink/utils/hlos/usr/Linux/ \
		SYSLINK_ROOT=${SYSLINK_INSTALL_DIR} \
		SYSLINK_PKGPATH="${IPC_INSTALL_DIR}/packages;${SYSLINK_INSTALL_DIR}" \
		ARCH=arm \
		CROSS_COMPILE=${CSTOOL_PREFIX} \
		TOOLCHAIN_PREFIX=${CSTOOL_PREFIX} \
		SYSLINK_PLATFORM=TI81XX \
		KDIR=$(LINUXKERNEL_INSTALL_DIR) clean

syslink_rtos: syslink_cfg
	XDCPATH=${SYSLINK_XDCPATH} \
		SYSLINK_ROOT=${SYSLINK_INSTALL_DIR} \
		${XDC_INSTALL_DIR}/xdc -P \
		`${XDC_INSTALL_DIR}/bin/xdcpkg ${SYSLINK_INSTALL_DIR}/ti/syslink | grep -v samples`

syslink_rtos_clean: syslink_cfg
	XDCPATH=${SYSLINK_XDCPATH} ${XDC_INSTALL_DIR}/xdc .make -PR ${SYSLINK_INSTALL_DIR}/ti/syslink/.
	XDCPATH=${SYSLINK_XDCPATH} ${XDC_INSTALL_DIR}/xdc clean -PR ${SYSLINK_INSTALL_DIR}/ti/syslink/.
	XDCPATH=${SYSLINK_XDCPATH} ${XDC_INSTALL_DIR}/xdc .interfaces -PR ${SYSLINK_INSTALL_DIR}/ti/syslink/.

syslink_clean: syslink_hlos_clean syslink_rtos_clean

syslink: syslink_hlos syslink_rtos

syslink_install:
	install -d $(EXEC_DIR)/syslink
	install ${SYSLINK_INSTALL_DIR}/ti/syslink/lib/modules/TI81XX/syslink.ko $(EXEC_DIR)/syslink
	cp ${SYSLINK_INSTALL_DIR}/ti/syslink/lib/syslink.a $(EXEC_DIR)/syslink
	@for file in $(shell find $(LINK_INSTALL_DIR)/dsplink/dsp/BUILD -name *.out); do \
	cp $$file $(EXEC_DIR)/dsplink ; \
	done

##############################################################################
#  Build c6accel
##############################################################################
c6accel:
	XDCPATH=${C6ACCEL_XDCPATH} \
	$(MAKE) -C $(C6ACCEL_INSTALL_DIR) \
	PLATFORM="TI816X" \
	CE_INSTALL_DIR="$(CE_INSTALL_DIR)" \
	XDAIS_INSTALL_DIR="$(XDAIS_INSTALL_DIR)" \
	LINK_INSTALL_DIR="$(SYSLINK_INSTALL_DIR)" \
	IPC_INSTALL_DIR="${IPC_INSTALL_DIR}" \
	OSAL_INSTALL_DIR="${OSAL_INSTALL_DIR}" \
	CMEM_INSTALL_DIR="$(CMEM_INSTALL_DIR)" \
	EDMA3_LLD_INSTALL_DIR="$(EDMA3_LLD_INSTALL_DIR)" \
	CODEGEN_INSTALL_DIR="$(CODEGEN_INSTALL_DIR)" \
	XDC_INSTALL_DIR="$(XDC_INSTALL_DIR)" \
	FC_INSTALL_DIR="$(FC_INSTALL_DIR)" \
	BIOS_INSTALL_DIR="$(SYSBIOS_INSTALL_DIR)" \
	C6ACCEL_INSTALL_DIR="$(C6ACCEL_INSTALL_DIR)" \
	CSTOOL_DIR="$(CSTOOL_DIR)" \
	CSTOOL_PREFIX="$(CSTOOL_PREFIX)" \
	BUILD_TYPE=debug \
	all

c6accel_clean:
	$(MAKE) -C $(C6ACCEL_INSTALL_DIR) \
	PLATFORM="TI816X" \
	CE_INSTALL_DIR="$(CE_INSTALL_DIR)" \
	XDAIS_INSTALL_DIR="$(XDAIS_INSTALL_DIR)" \
	LINK_INSTALL_DIR="$(LINK_INSTALL_DIR)" \
	IPC_INSTALL_DIR="${IPC_INSTALL_DIR}" \
	OSAL_INSTALL_DIR="${OSAL_INSTALL_DIR}" \
	CMEM_INSTALL_DIR="$(CMEM_INSTALL_DIR)" \
	EDMA3_LLD_INSTALL_DIR="$(EDMA3_LLD_INSTALL_DIR)" \
	CODEGEN_INSTALL_DIR="$(CODEGEN_INSTALL_DIR)" \
	XDC_INSTALL_DIR="$(XDC_INSTALL_DIR)" \
	FC_INSTALL_DIR="$(FC_INSTALL_DIR)" \
	BIOS_INSTALL_DIR="$(BIOS_INSTALL_DIR)" \
	SERVER_INSTALL_DIR="$(CODEC_INSTALL_DIR)" \
	C6ACCEL_INSTALL_DIR="$(C6ACCEL_INSTALL_DIR)" \
	CSTOOL_DIR="$(CSTOOL_DIR)" \
	CSTOOL_PREFIX="$(CSTOOL_PREFIX)" \
	clean

c6accel_install:
	$(MAKE) -C $(C6ACCEL_INSTALL_DIR) \
	PLATFORM="TI816X" \
	CMEM_INSTALL_DIR="$(CMEM_INSTALL_DIR)" \
	LINK_INSTALL_DIR="$(LINK_INSTALL_DIR)" \
	C6ACCEL_INSTALL_DIR="$(C6ACCEL_INSTALL_DIR)" \
	EXEC_DIR_C6ACCEL="$(EXEC_DIR)/c6accel" \
	install

################################################################################
# Build openGL demos
################################################################################
# opengldemos:
# 	$(MAKE) -C $(GRAPHICS_INSTALL_DIR) BUILD=release OMAPES=3.x all
# 
# opengldemos_clean:
# 	$(MAKE) -C $(GRAPHICS_INSTALL_DIR) BUILD=release OMAPES=3.x clean
# 
# opengldemos_install:
# 	$(MAKE) -C $(GRAPHICS_INSTALL_DIR) BUILD=release OMAPES=3.x install EXEC_DIR=$(EXEC_DIR)/opengl-demos
# 	for file in `find $(GRAPHICS_INSTALL_DIR)/gfx_rel_es3.x -name "*.ko"`; do \
# 	    install $${file} $(EXEC_DIR)/opengl-demos; \
# 	done
# 
