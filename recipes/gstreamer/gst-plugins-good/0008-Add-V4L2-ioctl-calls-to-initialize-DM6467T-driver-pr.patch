From bbfd15bc7439f7822679b61a5b7b99b71be2802a Mon Sep 17 00:00:00 2001
From: Don Darling <don.osc2@gmail.com>
Date: Tue, 16 Mar 2010 16:31:51 -0500
Subject: [PATCH 8/9] Add V4L2 ioctl calls to initialize DM6467T driver properly.

After calling the ENUMINPUT on an input, call S_INPUT and G_INPUT on that
input.  Otherwise, the video standards (norms) won't be detected properly.
---
 sys/v4l2/v4l2_calls.c |   19 +++++++++++++++++++
 1 files changed, 19 insertions(+), 0 deletions(-)

diff --git a/sys/v4l2/v4l2_calls.c b/sys/v4l2/v4l2_calls.c
index 1cad5e6..9b43125 100644
--- a/sys/v4l2/v4l2_calls.c
+++ b/sys/v4l2/v4l2_calls.c
@@ -145,6 +145,25 @@ gst_v4l2_fill_lists (GstV4l2Object * v4l2object)
       }
     }
 
+    #if defined(Platform_dm6467t)
+    /* Try setting the input and see if we can retrieve it as a valid setting.
+     * This is also needed to ensure the driver gets initialized properly.
+     */
+    if (v4l2_ioctl (v4l2object->video_fd, VIDIOC_S_INPUT, &input) < 0) {
+        GST_ELEMENT_ERROR (e, RESOURCE, SETTINGS,
+            (_("Failed to set input %d in device '%s'."),
+                n, v4l2object->videodev), GST_ERROR_SYSTEM);
+        return FALSE;
+    }
+
+    if (v4l2_ioctl (v4l2object->video_fd, VIDIOC_G_INPUT, &input) < 0) {
+        GST_ELEMENT_ERROR (e, RESOURCE, SETTINGS,
+            (_("Failed to get input %d in device '%s'."),
+                n, v4l2object->videodev), GST_ERROR_SYSTEM);
+        return FALSE;
+    }
+    #endif
+
     GST_LOG_OBJECT (e, "   index:     %d", input.index);
     GST_LOG_OBJECT (e, "   name:      '%s'", input.name);
     GST_LOG_OBJECT (e, "   type:      %08x", input.type);
-- 
1.6.3.3

